{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-user-md"></i> My Profile</h2>
            <div class="doctor-id">
                <i class="fas fa-id-badge"></i> Doctor ID: {{ doctor.doctor_id }}
                {% if validation_status == 'AUTHORIZED' %}
                <span class="badge bg-success ms-2">Verified</span>
                {% elif validation_status == 'BLACKLISTED' %}
                <span class="badge bg-danger ms-2">Blacklisted</span>
                {% else %}
                <span class="badge bg-warning ms-2">Not Found</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <!-- Basic Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user"></i> Basic Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Full Name:</strong> {{ doctor.first_name }} {{ doctor.last_name }}</p>
                        <p><strong>Email:</strong> {{ doctor.email }}</p>
                        <p><strong>Phone:</strong> {{ doctor.phone_number }}</p>
                        <p><strong>Specialization:</strong> {{ doctor.get_specialization_display }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Hospital:</strong> {{ doctor.hospital_name }}</p>
                        <p><strong>Experience:</strong> {{ doctor.years_of_experience }} years</p>
                        <p><strong>NMC Registration:</strong> {{ doctor.nmc_registration_number }}</p>
                        <p><strong>Medical License:</strong> {{ doctor.medical_license_number }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dataset Information -->
        {% if dataset_info %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-database"></i> Dataset Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Year of Info:</strong> {{ dataset_info.year_of_info }}</p>
                        <p><strong>Registration Number:</strong> {{ dataset_info.registration_number }}</p>
                        <p><strong>State Medical Council:</strong> {{ dataset_info.state_medical_council }}</p>
                        <p><strong>Father/Husband Name:</strong> {{ dataset_info.father_or_husband_name }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Primary Qualification:</strong> {{ dataset_info.qualification_1 }} ({{ dataset_info.qualification_1_year }})</p>
                        <p><strong>University:</strong> {{ dataset_info.university_name }}</p>
                        {% if dataset_info.qualification_2 %}
                        <p><strong>Secondary Qualification:</strong> {{ dataset_info.qualification_2 }} ({{ dataset_info.qualification_2_year }})</p>
                        {% endif %}
                        <p><strong>Date of Birth:</strong> {{ dataset_info.date_of_birth }}</p>
                        <p><strong>Date of Registration:</strong> {{ dataset_info.date_of_registration }}</p>
                        <p><strong>Age:</strong> {{ dataset_info.age }} years</p>
                        <p><strong>Experience:</strong> {{ dataset_info.experience_years }} years</p>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Dataset Information</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle"></i> 
                    Your information is not found in the official doctor dataset. 
                    Please contact the administrator for verification.
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Access Statistics -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line"></i> Access Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-3">
                        <h4 class="text-primary">{{ access_stats.total_accesses }}</h4>
                        <small class="text-muted">Total Accesses</small>
                    </div>
                    <div class="col-3">
                        <h4 class="text-danger">{{ access_stats.emergency_accesses }}</h4>
                        <small class="text-muted">Emergency</small>
                    </div>
                    <div class="col-3">
                        <h4 class="text-success">{{ access_stats.authorized_accesses }}</h4>
                        <small class="text-muted">Authorized</small>
                    </div>
                    <div class="col-3">
                        <h4 class="text-info">{{ access_stats.unique_patients }}</h4>
                        <small class="text-muted">Unique Patients</small>
                    </div>
                </div>
                {% if access_stats.last_access %}
                <hr>
                <div class="row">
                    <div class="col-12">
                        <h6>Last Access</h6>
                        <p class="text-muted">
                            {{ access_stats.last_access.patient.first_name }} {{ access_stats.last_access.patient.last_name }} - 
                            {{ access_stats.last_access.accessed_at|date:"M d, Y H:i" }}
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'doctors:dashboard' %}" class="btn btn-outline-primary">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="{% url 'doctors:emergency_access' %}" class="btn btn-outline-danger {% if not doctor.is_verified %}disabled{% endif %}">
                        <i class="fas fa-exclamation-triangle"></i> Emergency Access
                    </a>
                    <a href="{% url 'doctors:access_logs' %}" class="btn btn-outline-info">
                        <i class="fas fa-list"></i> Access Logs
                    </a>
                    <a href="{% url 'doctors:home' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-home"></i> Doctor Portal
                    </a>
                </div>
                {% if not doctor.is_verified %}
                <div class="alert alert-warning mt-3">
                    <small>
                        <i class="fas fa-info-circle"></i> 
                        Emergency access requires NMC verification.
                    </small>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Validation Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-shield-alt"></i> Validation Status</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    {% if validation_status == 'AUTHORIZED' %}
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h6 class="text-success">Authorized Doctor</h6>
                    <p class="text-muted">Your registration is verified and active.</p>
                    {% elif validation_status == 'BLACKLISTED' %}
                    <i class="fas fa-times-circle fa-3x text-danger mb-3"></i>
                    <h6 class="text-danger">Blacklisted</h6>
                    <p class="text-muted">Your registration is not authorized.</p>
                    {% else %}
                    <i class="fas fa-question-circle fa-3x text-warning mb-3"></i>
                    <h6 class="text-warning">Not Found</h6>
                    <p class="text-muted">Your information is not in the dataset.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Account Stats -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Account Stats</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h4 class="text-primary">{{ access_stats.total_accesses }}</h4>
                        <small class="text-muted">Total Accesses</small>
                    </div>
                    <div class="col-6">
                        <h4 class="text-info">{{ access_stats.unique_patients }}</h4>
                        <small class="text-muted">Unique Patients</small>
                    </div>
                </div>
                <hr>
                <div class="row text-center">
                    <div class="col-6">
                        <h6 class="text-success">{{ doctor.created_at|date:"M d" }}</h6>
                        <small class="text-muted">Member Since</small>
                    </div>
                    <div class="col-6">
                        <h6 class="text-warning">{{ doctor.years_of_experience }}</h6>
                        <small class="text-muted">Years Experience</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
